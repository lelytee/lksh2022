# Паросочетания


## Базовые понятия

Пусть есть $n$ Макнилов и $m$ Иришек Цыс. Про каждого Макнила и Ирину Цыс известно, с кем они не против обниматься (целоваться). Нужно составить как можно больше пар, в которых партнеры хотят обниматься (целоваться)

Более формально: Вам дан двудольный граф, в левой доле которого $n$ вершин, а в правой доле $m$ вершин. Требуется: максимальное паросочетание

**Паросочетанием** $M$ называется набор попарно несмежных рёбер графа

Вершины называются *насыщенными*, если у них есть смежное ребро из паросочетания

*Мощностью* паросочетания назовём количество рёбер в нём. 
*Максимальным* паросочетанием назовём паросочетание, мощность которого максимальна среди всех возможных паросочетаний в данном графе. 
*Совершенным* паросочетание назовём паросочетание, где все вершины левой доли им насыщенны.


## Лемма Бержа

**Цепью** длины $k$ назовём некоторый простой путь.
**Чередующейся цепью** назовём простой путь длины $k$ в котором рёбра поочередно принадлежат/не принадлежат паросочетанию.
**Увеличивающей цепью** назовём чередующуюся цепь, у которой начальная и конечная вершины не принадлежат паросочетанию.

Как подсказывает название, с помощью увеличивающей цепи можно увеличить мощность паросочетания на единицу. Для этого можно взять такую цепь и провести *чередование*: убрать из паросочетания все рёбра, принадлежащие цепи, и вместо них добавить все остальные ребра цепи.

Всего в увеличивающей цепи нечетное число рёбер, а первое и последнее были не в паросочетании. После чередования каждая затронутая вершина будет соединена ровно с одной из другой доли. Значит, после чередования паросочетание осталось корректным, а его мощность увеличилась ровно на единицу.

Раз чередованием увеличивающей цепи можно увеличить мощность паросочетания на единицу, то у максимального паросочетания увеличивающих цепей быть не должно. Оказывается, обратное тоже верно.


## Теорема Бержа

**Теорема.** Паросочетание без увеличивающих цепей является максимальным


## Лемма Хохла
**Лемма Холла.** Полное паросочетание существует тогда и только тогда, когда любая группа вершин левой доли соединена с не меньшим количеством вершин правой доли.

Док-ва для лохов, поэтому если вам так интересно - читайте на алгоритмике (откуда я собственно и копипастю этот конспект)


## А ТЫ НАШЛА (НАШЕЛ) КУНЧИКА???

**Алгоритм Куна** ровно в этом и заключается — начнем с пустого паросочетания и будем искать увеличивающие цепи, пока они ищутся.

Для поиска увеличивающей цепи можно мысленно построить граф, в котором из правой доли в левую можно идти только по рёбрам паросочетания, а из левой в правую — по любым. Тогда можно запустить поиск любого пути из свободной вершины левой доли в какую-нибудь свободную вершину правой доли в измененном графе, и ровно такой путь и будет увеличивающим.

**Псевдокод:**
```cpp
// g - граф, match - паросочетание, used - посещение вершины

void kuhn(int v){
    used[v] = true;
    for(auto &u : g[v]){
        if(match[u] == -1){
            match[u] = v;
            return true;
        }
    }
    for(auto &u : g[v]){
        if(!used[match[u]] && kuhn(match[u])){
            match[u] = v;
            return true;
        }
    }
    return false;
}

int main(){
    //... 
    int ans = 0;
    for(int i = 0; i < n; i++){
        used.assign(n, false);
        if(kuhn(i)){
            ans++;
        }
    }
}
```

Алгоритм ровно $n$ раз ищет увеличивающий путь, каждый раз просматривая не более $m$ рёбер, а значит суммарно отработает за $O(nm)$.


# Задачи

## Доминошки
Есть прямоугольное поле $n \times m$, которое содержит какие-то выколотые клетки. Надо положить на это поле как можно больше костей домино (прямоугольников размера $1 \times 2$), но с условием, что поверх выколотых полей ничего лежать не должно.

Составим граф, в котором вершины будут полями, а рёбрами будут возможности положить доминошку на два соседних свободных поля. Заметим, что такой граф будет двудольным: можно его покрасить как шахматную доску, и тогда черные клетки будут вершинами первой доли, а белые — второй.
